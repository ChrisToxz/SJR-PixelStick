var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
var btns=document.querySelectorAll(".topnav a:not(#select)"),pages=document.querySelectorAll(".page"),config,fixPresets,linkedPicker=0,ws,browserInit=!0;
function startSocket(){ws=new WebSocket("ws://"+location.hostname+":81/",["arduino"]);ws.onopen=function(){sendCmd("C");sendCmd("F");document.getElementById("sktled").style.backgroundColor="#80ff00";document.getElementsByTagName("body").disabled=!1};ws.onerror=function(a){alert("Websocket closed")};ws.onmessage=function(a){switch(a.data.substr(0,1)){case "V":updateVoltage(a.data.substr(1));break;case "U":updateComplete(a.data.substr(1));break;case "B":fillBmpList(a.data.substr(1));break;case "S":fillSysinfo(a.data.substr(1));
break;case "C":initPage(a.data.substr(1));break;case "F":initFixPresets(a.data.substr(1));break;case "I":document.getElementById("save").disabled="1"==a.data[1]?!1:!0;break;case "?":errorHandler(a.data);break;default:errorHandler("?Unknown response: "+a.data)}};ws.onclose=function(){document.getElementById("sktled").style.backgroundColor="#ff0000"}}function sendCmd(a){ws.send(a)}
function updateVoltage(a){var b=4+.00869*(a-480);a=document.getElementById("batticon");document.getElementById("voltage").innerHTML=b.toFixed(1)+"V";a.className="";7.7<b?b="images/batt-100.png":7.3<b?b="images/batt-075.png":6.9<b?b="images/batt-050.png":6.6<b?b="images/batt-025.png":(b="images/batt-010.png",a.className="blinking");a.src=b}
function updateComplete(a){var b=!0;switch(a[0]){case "0":case "1":config.ledson="1"==a[0]?!0:!1;setPowerSwitch();b=!1;break;case "A":a=a.substr(1).split(":");config.apssid=a[0];config.appw=a[1];break;case "B":config.colours[a[1]][2]=a.substr(2);break;case "C":document.getElementById("store").disabled=!0;alert("Client credentials updated");b=!1;break;case "D":b=!1;break;case "E":b=!1;break;case "F":fillFileData(a.substr(1));browserInit&&(browserInit=!1,sendCmd("I"),b=!1);break;case "G":config.colours[a[1]][1]=
a.substr(2);break;case "H":syncPreset(a[1]);break;case "I":config.brightness=a.substr(1);break;case "J":config.coloursused=a[1];break;case "K":config.gradient="1"==a[1]?!0:!1;break;case "L":config.delay=a.substr(1);break;case "M":b=!1;break;case "N":config.interleave="1"==a[1]?!0:!1;break;case "O":syncActiveColours(a);break;case "P":config.presetidx=a.substr(1);showParms();break;case "Q":config.presets[config.presetidx].paletteidx=a.substr(1);showParms();break;case "R":config.colours[a[1]][0]=a.substr(2);
break;case "S":b=!1;document.getElementById("save").disabled=!0;break;case "T":config.rowtime=a.substr(1);break;case "U":config.presets[config.presetidx].parms[a[1]].values[2]=a.substr(2);break;case "X":a=document.getElementById("delete");var c=a.selectedIndex;a.remove(c);document.getElementById("bitmaps").remove(c);sendCmd("S");a=document.getElementById("bitmaps").value;""!=a&&setCurrentBmp(a);break;case "?":errorHandler(a),b=!1}b&&(document.getElementById("save").disabled=!1)}
function setActivePage(a){if(!document.getElementById(a).classList.contains("active")){if("fixed"==a||"preset"==a||"bitmap"==a){switch(a){case "fixed":config.mode=0;break;case "preset":config.mode=1;break;case "bitmap":config.mode=2}sendCmd("UM"+config.mode)}btns.forEach(function(b){b.id==a?b.classList.add("active"):b.classList.remove("active")});pages.forEach(function(b){b.style.display=b.id==a+"panel"?"":"none"});"topnav"!==document.getElementById("myTopnav").className&&toggleMenu()}}
function toggleMenu(){var a=document.getElementById("myTopnav");"topnav"===a.className?(a.className+=" responsive",document.getElementById("menuicon").src="images/x.png"):(a.className="topnav",document.getElementById("menuicon").src="images/menu.png")}function toggleLEDs(){"pushbtn"===document.getElementById("power").className?sendCmd("U1"):sendCmd("U0")}
function setPowerSwitch(){var a=document.getElementById("power"),b=document.getElementById("bitmaps"),c=document.getElementById("delbtn");1==config.ledson?(a.className+=" on",b.disabled=!0,c.disabled=!0):(a.className="pushbtn",b.disabled=!1,looping=c.disabled=!1,document.getElementById("draw").innerHTML="Draw")}function saveSettings(){sendCmd("US")}function setDrawTime(){document.getElementById("drawtime").innerHTML=(document.getElementById("timsld").value*bmpHeight/1E3).toFixed(1)+"s"}
var setSliderTimer={};function setSlider(a){clearTimeout(setSliderTimer);setSliderTimer=setTimeout(function(){var b="U";switch(a){case "redsld":b=b+"R"+linkedPicker;break;case "grnsld":b=b+"G"+linkedPicker;break;case "blusld":b=b+"B"+linkedPicker;break;case "britesld":b+="I";break;case "timsld":b+="T";setDrawTime();break;case "p0sld":b+="U0";break;case "p1sld":b+="U1";break;case "p2sld":b+="U2"}sendCmd(b+document.getElementById(a).value)},50)}
function updatePicker(a,b){var c=a.id[6];document.getElementById("pickedcolour"+c).innerHTML=a.value.toUpperCase();if(c==linkedPicker){var d=parseInt("0x"+a.value.slice(1,3)),e=parseInt("0x"+a.value.slice(3,5)),f=parseInt("0x"+a.value.slice(5));updateSliderValue("redsld",d);updateSliderValue("grnsld",e);updateSliderValue("blusld",f);b&&(setSlider("redsld"),setTimeout(function(){return setSlider("grnsld")},55),setTimeout(function(){return setSlider("blusld")},110));sample.style.backgroundColor=a.value}else config.colours[c][0]=
parseInt("0x"+a.value.slice(1,3)),config.colours[c][1]=parseInt("0x"+a.value.slice(3,5)),config.colours[c][2]=parseInt("0x"+a.value.slice(5)),sendCmd("UR"+c+config.colours[c][0]),setTimeout(function(){return sendCmd("UG"+c+config.colours[c][1])},55),setTimeout(function(){return sendCmd("UB"+c+config.colours[c][2])},110)}function setColoursUsed(a){sendCmd("UJ"+a)}function setGradient(a){sendCmd("UK"+(a?"1":"0"))}
function setInterleave(a){a?document.getElementById("gradient").disabled=!0:document.getElementById("gradient").disabled=!1;sendCmd("UN"+(a?"1":"0"))}function setPicker(a){var b=document.getElementById("picker"+a);linkedPicker=a;updatePicker(b,!1);sample.style.backgroundColor=b.value}
function updateColour(a){a=document.getElementById("picker"+a);var b=document.getElementById("redsld"),c=document.getElementById("grnsld"),d=document.getElementById("blusld");for(b=(b.value<<16|c.value<<8|d.value).toString(16);6>b.length;)b="0"+b;a.value="#"+b;document.getElementById("pickedcolour"+linkedPicker).innerHTML=a.value.toUpperCase();sample.style.backgroundColor=a.value}
function updateSliderValue(a,b){document.getElementById(a).value=b;document.getElementById(a+"val").innerHTML=b;"redsld"!=a&&"grnsld"!=a&&"blusld"!=a||updateColour(linkedPicker)}function togglePw(a){a=document.getElementById(a);a.type="password"===a.type?"text":"password"}
function checkValid(a,b,c){1>b&&(b=1);(new RegExp("^([a-z]|[A-Z]|[0-9]|[-_,'#\u00a3$% ]!){"+b+","+c+"}$")).test(document.getElementById(a).value)?(a.startsWith("ap")&&(b="UA"+document.getElementById("apssid").value,b=b+":"+document.getElementById("appw").value,sendCmd(b)),a.startsWith("client")&&""!=document.getElementById("clientssid").value&&""!=document.getElementById("clientpw").value&&(document.getElementById("store").disabled=!1),"fixname"==a&&(document.getElementById("fpsave").disabled=!1)):
(alert("Invalid: Only alphanumeric and '-_,'#\u00a3$% ]!' characters allowed and must be between "+b+" and "+c+" characters long"),a.startsWith("client")&&(document.getElementById("store").disabled=!0),"fixname"==a&&(document.getElementById("fpsave").disabled=!0))}function checkNumber(a,b,c){a=Number(document.getElementById(a).value);a<b||a>c?alert("Invalid: Must be a value between "+b+" and "+c):sendCmd("UL"+a)}
function saveCredentials(){var a="UC"+document.getElementById("clientssid").value;a=a+":"+document.getElementById("clientpw").value;sendCmd(a)}
function checkFilename(){var a=document.getElementById("upload").value;if(a){var b=0<=a.indexOf("\\")?a.lastIndexOf("\\"):a.lastIndexOf("/");b=a.substring(b);if(0===b.indexOf("\\")||0===b.indexOf("/"))b=b.substring(1)}a=document.getElementById("subupload");32>b.length&&b.endsWith(".bmp")?a.disabled=!1:(a.disabled=!0,alert("Must be a *.bmp file with a name less than 32 characters long"))}function setFixPreset(a){sendCmd("UH"+document.getElementById("fixpresets").selectedIndex)}
function syncActiveColours(a){var b=a[1];fixPresets[b].name=a.substr(2);fixPresets[b].coloursused=config.coloursused;fixPresets[b].gradient=config.gradient;fixPresets[b].interleave=config.interleave;for(var c=0;c<config.coloursused;c++)fixPresets[b].colours[c][0]=config.colours[c][0],fixPresets[b].colours[c][1]=config.colours[c][1],fixPresets[b].colours[c][2]=config.colours[c][2];document.getElementById("fpsave").disabled=!0;document.getElementById("fixname").value="";b=document.getElementById("fixpresets").options[a[1]];
b.value=b.text=a.substr(2)}
function syncPreset(a){config.coloursused=fixPresets[a].coloursused;config.gradient=fixPresets[a].gradient;config.interleave=fixPresets[a].interleave;for(var b=0;b<config.coloursused;b++){config.colours[b][0]=fixPresets[a].colours[b][0];config.colours[b][1]=fixPresets[a].colours[b][1];config.colours[b][2]=fixPresets[a].colours[b][2];for(var c=document.getElementById("picker"+b),d=(config.colours[b][0]<<16|config.colours[b][1]<<8|config.colours[b][2]).toString(16);6>d.length;)d="0"+d;c.value="#"+d;
document.getElementById("pickedcolour"+b).innerHTML=c.value.toUpperCase();b==linkedPicker&&(document.getElementById("redsld").value=config.colours[b][0],document.getElementById("redsldval").innerHTML=config.colours[b][0],document.getElementById("grnsld").value=config.colours[b][1],document.getElementById("grnsldval").innerHTML=config.colours[b][1],document.getElementById("blusld").value=config.colours[b][2],document.getElementById("blusldval").innerHTML=config.colours[b][2],sample.style.backgroundColor=
c.value)}document.getElementById("col"+config.coloursused).checked=!0;document.getElementById("gradient").checked=config.gradient;document.getElementById("gradient").disabled=config.interleave?!0:!1;document.getElementById("interleave").checked=config.interleave}
function saveFixPreset(){console.log("Save preset");for(var a="Enter the slot number you want to store this preset in:\n\n",b=0,c=$jscomp.makeIterator(fixPresets),d=c.next();!d.done;d=c.next())x=d.value,a+=b+" - "+x.name+"\n",b++;(a=prompt(a))&&""!=a&&(a=parseInt(a),Number.isInteger(a)&&0<=a&&7>=a?(a="UO"+a+document.getElementById("fixname").value,sendCmd(a)):alert("Please enter an integer between 0 and 7"))}
function initFixPresets(a){fixPresets=JSON.parse(a);a=document.getElementById("fixpresets");for(var b=$jscomp.makeIterator(fixPresets),c=b.next();!c.done;c=b.next())x=c.value,c=document.createElement("option"),c.text=x.name,c.value=x.name,a.add(c);a.selectedIndex=-1}
function initPage(a){config=JSON.parse(a);setPowerSwitch(config.ledson);updateSliderValue("britesld",config.brightness);document.getElementById("delay").value=config.delay;document.getElementById("col"+config.coloursused).checked=!0;document.getElementById("gradient").checked=config.gradient;document.getElementById("interleave").checked=config.interleave;document.getElementById("gradient").disabled=config.interleave;updateSliderValue("redsld",config.colours[0][0]);updateSliderValue("grnsld",config.colours[0][1]);
updateSliderValue("blusld",config.colours[0][2]);for(a=1;5>a;a++){for(var b=document.getElementById("picker"+a),c=(config.colours[a][0]<<16|config.colours[a][1]<<8|config.colours[a][2]).toString(16);6>c.length;)c="0"+c;b.value="#"+c;document.getElementById("pickedcolour"+a).innerHTML=b.value.toUpperCase()}fillPresets();updateSliderValue("timsld",config.rowtime);sendCmd("S");sendCmd("B");document.getElementById("apssid").value=config.apssid;document.getElementById("appw").value=config.appw;switch(config.mode){case 0:var d=
"fixed";break;case 1:d="preset";break;case 2:d="bitmap";break;default:errorHandler("?Invalid mode: "+mode)}setActivePage(d)}
function fillBmpList(a){a=a.split(":");filesel=document.getElementById("bitmaps");delsel=document.getElementById("delete");a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){x=b.value;b=document.createElement("option");var c=document.createElement("option");b.text=x;b.value="/bmp/"+x;c.text=x;c.value="/bmp/"+x;config.bmpfile.endsWith(x)&&(b.selected=!0,sendCmd("UF"+b.value));filesel.add(b);delsel.add(c)}delsel.selectedIndex=-1}
function setPreset(){sendCmd("UP"+document.getElementById("presets").selectedIndex)}function setCurrentBmp(a){config.bmpfile!=a&&(sendCmd("UF"+a),config.bmpfile=a)}function deleteFile(){var a=document.getElementById("delete").value;""!=a&&confirm("Delete "+a+"?")&&sendCmd("UX"+a)}var looping=!1;
function drawBitmap(){var a="UD0";config.ledson=!0;setPowerSwitch();if(document.getElementById("repeat").checked&&!looping){a="UD1";looping=!0;var b="Stop"}else looping=!1,b="Draw";sendCmd(a);document.getElementById("draw").innerHTML=b}function setRepeat(a){sendCmd("UE"+(a?"1":"0"))}var bmpWidth,bmpHeight;function fillFileData(a){a=a.split(":");bmpWidth=a[0];bmpHeight=a[1];a=a[0]+"px x "+a[1]+"px";document.getElementById("currentfile").innerHTML=a;showPreview();setDrawTime()}
function showPreview(){var a=(window.innerWidth-20)/bmpHeight,b=1<=a?"translate(0, -100%)":"translate(0, -"+100*a+"%) scale("+a+")";document.getElementById("preview").src=document.getElementById("bitmaps").value;document.getElementById("preview").style.transformOrigin="0 0";document.getElementById("preview").style.transform="rotate(90deg) "+b;1>=a?document.getElementById("prevtxt").style.transform="translate(0, "+(a-1)*bmpWidth+"px)":document.getElementById("prevtxt").style.transform="translate(0, 0)"}
function fillPresets(){var a=config.presets,b=document.getElementById("presets");a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())x=c.value,c=document.createElement("option"),c.text=x.name,c.value=x.name,b.add(c);b.selectedIndex=config.presetidx;a=config.palettes;b=document.getElementById("palette");a=$jscomp.makeIterator(a);for(c=a.next();!c.done;c=a.next())x=c.value,c=document.createElement("option"),c.text=x,c.value=x,b.add(c);showParms()}
function showParms(){var a=config.presets[config.presetidx];document.getElementById("parms").style.display="none";document.getElementById("parm0").style.display="none";document.getElementById("parm1").style.display="none";document.getElementById("parm2").style.display="none";document.getElementById("palettes").style.display="none";var b=0;if("undefined"!==typeof a.parms){for(var c=$jscomp.makeIterator(a.parms),d=c.next();!d.done;d=c.next())parm=d.value,document.getElementById("p"+b+"name").innerHTML=
parm.name,document.getElementById("p"+b+"sld").min=parm.values[0],document.getElementById("p"+b+"sld").max=parm.values[1],updateSliderValue("p"+b+"sld",parm.values[2]),document.getElementById("parm"+b).style.display="",b+=1;document.getElementById("parms").style.display=""}"undefined"!==typeof a.paletteidx&&(document.getElementById("palettes").style.display="",document.getElementById("palette").selectedIndex=a.paletteidx,document.getElementById("parms").style.display="")}
function setPalette(){sendCmd("UQ"+document.getElementById("palette").selectedIndex)}function fillSysinfo(a){document.getElementById("fsinfo").innerHTML=a}function errorHandler(a){alert(a.substr(1))};